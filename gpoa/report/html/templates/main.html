<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/usr/lib/python3/site-packages/gpoa/report/html/styles/style.css">
    <title>GPResult</title>
</head>
<body>
    <script src="/usr/lib/python3/site-packages/gpoa/report/html/scripts/script.js"></script>
    <!--  -->
    <table class="table" border="1">
        <tr style="background-color: #A0BACB;">
            <td>
                <div>
                    {% if info["is_machine"] == 'True' %}
                        Group Policy Results (<b>for computer</b>)
                    {% else %}
                        Group Policy Results (<b>for user</b>)
                    {% endif %}
                </div>
                <div style="margin:0 auto;text-align: right">
                    <span id="show_all" class="section_title_span" onclick="show_hide_all(id)">
                        show all
                    </span>
                </div>
            </td>
        </tr>
        <tr>
            <td align="left" style="padding-left: 20 px">
                <table style="width: 100%">
                    {% if info["type"] == "report_user"%}
                        <tr>
                            <td>
                                <b>User name:</b>
                            </td>
                            <td>
                                {{ info["user_name"] }}
                            </td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td>
                            <b>Computer name:</b>
                        </td>
                        <td>
                            {{ info["computer_name"] }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Domain:</b>
                        </td>
                        <td>
                            {{ info["domain"] }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <br><br>
                            TimeStamp: {{ info["timestamp"] }}
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <!--  -->
    <!-- <div class="section"> -->

        {% set headers = ({"warnings":"Warnings", "errors":"Errors", "gpos":"GPOs", "summary":"Summary", "details":"Details", "admtempls":"Administrative Templates", "regkeys":"Registry keys"}) %}

        {% for k, v in info.items() %}
            {% if v is mapping%}
                <div class="section">
                        {% set id = k ~ "_div" %}
                        <div id={{id}} class="section_title" onclick="show_hide(id)">
                            <span class="section_title_span" tabindex="0">
                                {{ headers[k] }}
                            </span>
                        </div>

                        {% set id = k ~ "_container" %}
                        <div id={{id}} class="container" style="display: none;">
                {% if k == "summary"%}
                        <div class="secsection">
                            {% for k1, v1 in v.items()%}
                                {% if k1 == "errors" or k1 == "warnings"%}
                                    <div class="section">
                                        {% set id = k1 ~ "_div" %}
                                        <div id={{id}} class="section_title" onclick="show_hide(id)">
                                            <span class="section_title_span" tabindex="0">
                                                {{ headers[k1] }}
                                            </span>
                                        </div>
                                        {% set id = k1 ~ "_container" %}
                                        <div id={{id}} class="container" style="display: none;">
                                            <div class="secsection">
                                        <!-- отрисовка ошибок и предупреждений -->
                                                {% if v1 |length != 0%}
                                                    <table class="tablein">
                                                        <tr class="trin">
                                                            <td> <b> </b> </td>
                                                            <td style="width: 50%;"> <b>Text</b> </td>
                                                            <td style="width: 50%;"> <b>Additionaly</b> </td>
                                                        </tr>
                                                        {% for e in v1%}
                                                            <tr class="trin"></tr>
                                                                <td>
                                                                    {% if k1 == "errors" %}
                                                                    <svg width="15" height="15" viewBox="0 0 15 15">
                                                                        <image x="0" y="0" width="15" height="15" xlink:href="/usr/lib/python3/site-packages/gpoa/report/html/imgs/error.jpg"/>
                                                                    </svg>
                                                                    {% elif k1 == "warnings" %}
                                                                        <svg width="15" height="15" viewBox="0 0 15 15">
                                                                            <image x="0" y="0" width="15" height="15" xlink:href="/usr/lib/python3/site-packages/gpoa/report/html/imgs/warning.jpg"/>
                                                                        </svg>
                                                                    {% endif %}
                                                                </td>
                                                                <td style="width: 45%;">{{ e["text"] }}</td>
                                                                <td style="width: 45%;">{{ e["info"] }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% else %}
                                                    No data.
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                {% elif k == "details" %}
                        <div class="secsection">
                            {% for k_det, val_det in v.items() %}

                                <div class="section">
                                    {% set id = k_det ~ "_container" %}
                                    <div id={{id}} class="section_title" onclick="show_hide(id)">
                                        <span class="section_title_span">
                                            {{headers[k_det]}}
                                        </span>
                                    </div>

                                    {% set id = k_det ~ "_container" %}
                                    <div id={{id}} class="container" style="display: none;">

                                        {% if k_det == "regkeys"%}
                                            {% for k_rk, v_rk in val_det.items() %}
                                                <div class="secsection">
                                                    {% set id = k_rk ~ "_" ~ loop.index ~ "_div" %}
                                                    <div id={{id}} class="section_title" onclick="show_hide(id)">
                                                        <span class="section_title_span" tabindex="0">
                                                            {{ k_rk }}
                                                        </span>
                                                    </div>

                                                    {% set id = k_rk ~ "_" ~ loop.index ~ "_container" %}
                                                    <div id={{id}} class="container" style="display: none;">
                                                        <div class="secsection">
                                                            Registry key info:

                                                            <table class="tablein">
                                                                <!-- заголовок - ключи словаря -->
                                                                <tr class="trin">
                                                                    {% for header in v_rk[0].keys()%}
                                                                        {% if header != "type" %}
                                                                            <td style="width: 30%;"><b>{{header}}</b></td>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </tr>

                                                                {% for dict_info in v_rk%}
                                                                    <tr class="trin">
                                                                        {% for kk_rk, value_rk in dict_info.items() %}
                                                                            {% if kk_rk != "type" %}
                                                                                <td style="width: 30%;">{{value_rk}}</td>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </tr>
                                                                {% endfor %}
                                                            </table>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor%}

                                        {% elif k_det == "gpos" %}
                                            {% set id = k_det ~ "_" ~ loop.index ~ "_div" %}
                                            <div class="secsection">
                                                Received Group Policy objects:
                                                {% if val_det |length != 0%}
                                                    <table class="tablein">
                                                        <tr class="trin">
                                                            <td> <b>Name</b> </td>
                                                            <td> <b>UUID</b> </td>
                                                            <td> <b>file_sys_path</b> </td>
                                                        </tr>
                                                        {% for gpo in val_det%}    
                                                            <tr class="trin"></tr>
                                                                <td>{{gpo["name_gpo"]}}</td>
                                                                <td>{{gpo["uuid"]}}</td>
                                                                <td>{{gpo["path"]}}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% else %}
                                                    No data.
                                                {% endif %}
                                            </div>
                                        {% elif k_det == "admtempls" %}
                                            {%if val_det |length != 0%}
                                                {% for templ_dict in val_det%}
                                                    <div class="secsection">
                                                        {% set id = templ_dict["name"] ~ "_" ~ loop.index ~ "_div" %}
                                                        <div id={{id}} class="section_title" onclick="show_hide(id)">
                                                            <span class="section_title_span" tabindex="0">
                                                                {{ templ_dict["name"] }}
                                                            </span>
                                                        </div>

                                                        {% set id = templ_dict["name"] ~ "_" ~ loop.index ~ "_container" %}
                                                        <div id={{id}} class="container" style="display: none;">
                                                            <div class="secsection">
                                                                Policy info:
                                                                {% if templ_dict["name"] == "Mozzila Firefox"%}
                                                                    {% for k_obj, v_obj in templ_dict["policies"].items()%}
                                                                        <table class="tablein">
                                                                            <tr class="trin">
                                                                            <td><b>{{k_obj}}:</b></td>
                                                                            </tr>
                                                                        
                                                                            {% for pol_k_obj, pol_v_obj in v_obj.items() %}
                                                                            <tr class="trin">
                                                                                <td style="width: 30%;">{{pol_k_obj}}</td>
                                                                                <td>{{pol_v_obj}}</td>
                                                                            </tr>
                                                                            {% endfor %}
                                                                        </table>
                                                                    {% endfor %}
                                                                {% else %}
                                                                    {% for k_obj, v_obj in templ_dict["policies"].items()%}
                                                                        <table class="tablein">
                                                                            <tr class="trin">
                                                                                <td style="width: 30%;">{{k_obj}}</td>
                                                                                <td>{{v_obj}}</td>
                                                                            </tr>
                                                                        </table>
                                                                    {% endfor %}
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <div class="secsection">
                                                    No data.
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        
                {% endif %}
                </div>
            </div> 
            {% endif %}
        {% endfor %}
</body>
</html>